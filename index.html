<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">











<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>maven-nar-plugin - Maven NAR Plugin</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                                    
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"></script>
                                                        
<script type="text/javascript">_uacct = "UA-140879-1";
        urchinTracker();</script>
                    </head>
  <body class="composite">
    <div id="banner">
                  <a href="" id="bannerLeft">
    
                                    <img src="http://maven.apache.org/images/apache-maven-project.png" alt="" />
    
            </a>
                        <a href="http://maven.apache.org/" id="bannerRight">
    
                                    <img src="http://maven.apache.org/images/maven-logo-2.gif" alt="" />
    
            </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
  

  
    
            
  
    
            <div class="xleft">
          
                <a href="http://www.apache.org/" class="externalLink">Apache</a>
                &gt;
      
                <a href="http://maven.apache.org/index.html" class="externalLink">Maven</a>
                &gt;
      
                <a href="http://maven.apache.org/plugins/index.html" class="externalLink">Plugins</a>
                &gt;
      
                <a href="http://duns.github.com/maven-nar-plugin/" class="externalLink">Maven NAR Plugin</a>
                  </div>
            <div class="xright">            <a href="http://java.freehep.org/maven1.x/freehep-nar-plugin" class="externalLink">NAR Plugin for Maven1</a>
            |
                <a href="http://maven.apache.org/maven2/" class="externalLink">Maven 2</a>
            
  

  
    
            
  
    
            &nbsp;| Last Published: 2009-10-13
              &nbsp;| Version: 2.1-SNAPSHOT
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
  

  
    
            
  
    
                   <h5>Overview</h5>
            <ul>
              
    <li class="none">
              <strong>Introduction</strong>
        </li>
              
    <li class="none">
                    <a href="philosophy.html">Philosophy</a>
          </li>
              
    <li class="none">
                    <a href="NARPlugin.ppt">Presentation (ppt)</a>
          </li>
          </ul>
              <h5>User Info</h5>
            <ul>
              
    <li class="none">
                    <a href="plugin-info.html">Goals</a>
          </li>
              
    <li class="none">
                    <a href="usage.html">Usage</a>
          </li>
              
    <li class="none">
                    <a href="lifecycle.html">Lifecycle</a>
          </li>
              
    <li class="none">
                    <a href="configuration.html">Configuration</a>
          </li>
              
    <li class="none">
                    <a href="faq.html">FAQ</a>
          </li>
              
    <li class="none">
                    <a href="aol.html">AOL Properties</a>
          </li>
          </ul>
              <h5>Developer Info</h5>
            <ul>
              
    <li class="none">
                    <a href="narDependencies.html">NAR Dependencies</a>
          </li>
              
    <li class="none">
                    <a href="https://issues.sonatype.org/browse/NAR" class="externalLink">Bug Reports</a>
          </li>
              
    <li class="none">
                    <a href="http://forum.freehep.org/index.php?t=threadt&frm_id=14&rid=4" class="externalLink">Forum</a>
          </li>
              
    <li class="none">
                    <a href="apidocs/index.html">APIDocs</a>
          </li>
              
    <li class="none">
                    <a href="narLibrary.html">NAR Library</a>
          </li>
              
    <li class="none">
                    <a href="cpptasks.html">CPPTasks</a>
          </li>
              
    <li class="none">
                    <a href="http://github.com/duns/maven-nar-plugin" class="externalLink">Git Browse nar-plugin</a>
          </li>
              
    <li class="none">
                    <a href="http://github.com/duns/cpptasks-parallel" class="externalLink">Git Browse cpptasks</a>
          </li>
              
    <li class="none">
                    <a href="source-repository.html">Git Repository</a>
          </li>
          </ul>
              <h5>Examples</h5>
            <ul>
              
    <li class="none">
                    <a href="HelloWorld.html">HelloWorld</a>
          </li>
          </ul>
              <h5>Other Information</h5>
            <ul>
              
    <li class="none">
                    <a href="http://docs.codehaus.org/display/MAVEN/Support+for+other+languages" class="externalLink">Maven and other languages</a>
          </li>
          </ul>
                        <h5>Project Documentation</h5>
            <ul>
              
                
              
            
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
            <li class="expanded">
                    <a href="project-info.html">Project Information</a>
                  <ul>
                  
    <li class="none">
              <strong>About</strong>
        </li>
                  
    <li class="none">
                    <a href="integration.html">Continuous Integration</a>
          </li>
                  
    <li class="none">
                    <a href="dependencies.html">Dependencies</a>
          </li>
                  
    <li class="none">
                    <a href="issue-tracking.html">Issue Tracking</a>
          </li>
                  
    <li class="none">
                    <a href="mail-lists.html">Mailing Lists</a>
          </li>
                  
    <li class="none">
                    <a href="plugin-management.html">Plugin Management</a>
          </li>
                  
    <li class="none">
                    <a href="license.html">Project License</a>
          </li>
                  
    <li class="none">
                    <a href="plugins.html">Project Plugins</a>
          </li>
                  
    <li class="none">
                    <a href="project-summary.html">Project Summary</a>
          </li>
                  
    <li class="none">
                    <a href="team-list.html">Project Team</a>
          </li>
                  
    <li class="none">
                    <a href="source-repository.html">Source Repository</a>
          </li>
              </ul>
        </li>
              
                
              
      
            
      
              
        <li class="collapsed">
                    <a href="project-reports.html">Project Reports</a>
                </li>
          </ul>
              <h5>Maven Projects</h5>
            <ul>
              
    <li class="none">
                    <a href="http://maven.apache.org/ant-tasks/index.html" class="externalLink">Ant Tasks</a>
          </li>
              
    <li class="none">
                    <a href="http://maven.apache.org/doxia/index.html" class="externalLink">Doxia</a>
          </li>
              
    <li class="none">
                    <a href="http://maven.apache.org/jxr/index.html" class="externalLink">JXR</a>
          </li>
              
    <li class="none">
                    <a href="http://maven.apache.org/maven-1.x/index.html" class="externalLink">Maven 1.x</a>
          </li>
              
    <li class="none">
                    <a href="http://maven.apache.org/index.html" class="externalLink">Maven 2</a>
          </li>
              
    <li class="none">
                    <a href="http://maven.apache.org/mercury/index.html" class="externalLink">Mercury</a>
          </li>
              
    <li class="none">
                    <a href="http://maven.apache.org/plugins/index.html" class="externalLink">Plugins</a>
          </li>
              
    <li class="none">
                    <a href="http://maven.apache.org/scm/index.html" class="externalLink">SCM</a>
          </li>
              
    <li class="none">
                    <a href="http://maven.apache.org/shared/index.html" class="externalLink">Shared Components</a>
          </li>
              
    <li class="none">
                    <a href="http://maven.apache.org/surefire/index.html" class="externalLink">Surefire</a>
          </li>
              
    <li class="none">
                    <a href="http://maven.apache.org/wagon/index.html" class="externalLink">Wagon</a>
          </li>
          </ul>
                                           <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
            <img alt="Built by Maven" src="./images/logos/maven-feather.png"></img>
          </a>
                       
  

  
    
            
  
    
        </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Introduction</h2>
<p>NOTE: <b>bold</b> print is <b>NOT implemented yet</b>.</p>
<p>This plugin for Maven 2 allows you to compile native code (c++, c and fortran) on a number of different architectures (Linux, Windows, MacOSX, Solaris, ...) and with a number of different compilers/linkers (g++, Microsoft Visual C++, CC, ...) The output produced is wrapped up in Native ARchive files (.nar) some of which are machine independent (-noarch), while others are machine specific and thus depend on a combination of machine architecture(A), operating-system(O) and linker(L) identified as AOL. These nar files can be installed in the local maven repository and deployed to a standard maven (web) server, using the standard maven-install-plugin and maven-deploy-plugin.</p>
<p>Other maven projects may specify dependencies on these nar files using the standard maven dependency declaration. Nar files get downloaded, unpacked and installed in the local maven repository, just like jar files are (apart from the unpacking).</p>
<p>The NAR plugin executes the following goals, in the order below, to create and deploy nar files. The goals are part of the <tt>nar</tt> packaging/<a href="lifecycle.html">lifecycle</a>, which inserts the nar goals into the standard lifecyle. Using nar packaging allows you to build a jar file as well as nar files. The list below shows the sequence of the NAR goals:</p>
<ol type="1"><li><a href="#nar-download">nar-download</a></li>
<li><a href="#nar-system-generate">nar-system-generate</a></li>
<li><a href="#nar-unpack">nar-unpack</a></li>
<li><a href="#nar-resources">nar-resources</a></li>
<li><a href="#nar-javah">nar-javah</a></li>
<li><a href="#nar-compile">nar-compile</a></li>
<li><a href="#nar-testCompile">nar-testCompile</a></li>
<li><a href="#nar-test">nar-test</a></li>
<li><a href="#nar-package">nar-package</a></li>
<li><a href="#nar-integration-test">nar-integration-test</a></li>
<li><a href="#install">install (standard maven goal)</a></li>
<li><a href="#deploy">deploy (standard maven goal)</a></li>
</ol>
<div class="section"><h3>Initialization</h3>
<p>The NAR Plugin starts off by setting and deducing all kinds of property values for usage in the goals below. The configuration section of the NAR plugin allows one to override most of the default settings. The default settings come from the AOL properties file which allows us to specify different defaults depending on the architecture-os-linker combination, see <a href="aol.html">AOL Properties</a>.</p>
<p>The NAR Plugin tries to deduce the &quot;Operating System&quot; and the &quot;Architecture&quot; of the machine. Both can be overridden by setting <tt>os</tt> and <tt>arch</tt> in the <a href="configuration.html">configuration</a>.</p>
<p>The name of the linker is looked up in a architecture-os specific way, but can be overridden by setting <tt>linker.name</tt> (this means the subtag &lt;name&gt; of the &lt;linker&gt; tag in the configuration section). Now that the linker name is known all other properties are looked up with a prefix of <tt>[arch.[os.[linker.]]]</tt> from the AOL Properties file, but can be overridden in the configuration section (which can be made AOL specific by putting it inside a profile.</p>
</div>
<div class="section"><h3><a name="nar-download">nar-download</a></h3>
<p>Your NAR artifact(s) may be dependent on other nar artifacts. The standard maven dependency declaration in the POM is used to describe such dependencies, see <a href="nar-dependencies.html"> nar-dependencies</a>. By the time this goal is running maven will have already downloaded all dependent jar files some of which may include a nar.properties file. This property file contains information on what other machine dependent and machine independent nar files to download. This goal will download any further necessary nar files into the local repository.</p>
</div>
<div class="section"><h3><a name="nar-system-generate">nar-system-generate</a></h3>
<p>This goal generates a NarSystem class if necessary. This class contains helper methods for your code to handle things at run-time. The static method &quot;loadLibrary()&quot; is currently the only method generated and will load your JNI library with name &quot;artifactId-version&quot;. This goals only executed if you produce a JNI library and you specify a <i>packageName</i> as subtag of <i>library</i>. The NarSystem class will then end up in this package.</p>
</div>
<div class="section"><h3><a name="nar-unpack">nar-unpack</a></h3>
<p>Since a nar file is of no use to any native compilation process the nar-unpack goal unpacks the nar into the &quot;nar&quot; subdirectory of the local repository. A flag is set not to download and unpack this nar file again, except if it is a SNAPSHOT artifact. <b>TBD The actual nar file is deleted to preserve diskspace.</b></p>
</div>
<div class="section"><h3><a name="nar-resources">nar-resources</a></h3>
<p>This is an optional goal. It will take any resources in src/nar/resources and copy them into specific areas under target/nar. Resources may include pre-compiled/linked libraries and other shareable items. This goal can be used to create a nar library from a distribution that comes with compiled shareable libraries.</p>
</div>
<div class="section"><h3><a name="nar-javah">nar-javah</a></h3>
<p>This goal will run the javah tool on any class file in the <tt>javah.classDirectory</tt> directory that has native methods in it. The actual class files are inspected (rather than their sources). The javah tool is picked up from the java installation and is run with a classpath of the <tt>javah.classDirectory</tt> and all depencies' classpaths, unless you specify a list in <tt>javah.classPaths</tt>. You can also set a boot classpath using <tt>javah.bootClassPaths</tt>.</p>
<p>This goal has no effect if there are no java sources, or if none of the java classes contain a native method.</p>
</div>
<div class="section"><h3><a name="nar-compile">nar-compile</a></h3>
<p>This goal will compile the native source code (c, c++ or fortran) and archive it into a shared library. You can also produce a jni or a static library by setting <tt>library.type</tt>. To handle the variety of compilers and linkers, the NAR plugin uses the cpptasks from the ant-contrib project, with some minor improvements and additions of compilers, see <a href="cpptasks.html">cpptasks</a>. Most of the settings for cpptasks, such as compiler, linker, options and include dirs are available through the NAR plugin, see <a href="configuration.html">configuration</a>.</p>
<p>The NAR plugin searches the directory structure under COMPILER.sourceDirectory, which defaults to src/main. The standard way to separate your sources for different languages would be src/main/c, src/main/c++ and src/main/fortran, but any file under src/main is searched for.</p>
<p>The nar plugin will automatically select the correct compiler (c, c++ or fortran) based on the type of source, as specified in the patterns in <tt>AOL.c.includes</tt>, <tt>AOL.cpp.includes</tt> and <tt>AOL.fortran.includes</tt>, where AOL is a dotted qualifier of the architecture, os and linker (x86.Windows.msvc for example).</p>
<p>Include paths are added in this order from:</p>
<ul><li>any directories set in <tt>COMPILER.includePaths</tt>, where COMPILER is c, cpp or fortran.</li>
<li>the <tt>javah.jniDirectory</tt>.</li>
<li>only if <tt>java.include</tt> is true or if <tt>javah.jniDirectory</tt> exists we add one of the following, relative to the java home directory:<ul><li><tt>java.includePaths</tt> if set,</li>
<li>otherwise the <tt>AOL.java.include</tt> property from the AOL properties.</li>
</ul>
</li>
<li>the header files of any of the nar type dependencies, unless it is a jni library.</li>
<li>any system directories set in <tt>COMPILER.sysincludepath</tt>, where COMPILER is c, cpp or fortran.</li>
</ul>
<p>The static or dynamic library is linked against:</p>
<ul><li>the list of libraries set in <tt>linker.libs</tt>. Using nar dependencies is preferred though.</li>
<li>the libraries of any of the nar type dependencies.</li>
<li>the java virtual machine if you set <tt>java.link</tt> to true. The location of the runtime can be overridden in <tt>java.runtimeDirectory</tt>.</li>
</ul>
<p>All include files from <tt>COMPILER.includePaths</tt> are copied to be included in the noarch nar file.</p>
<p><b> TBD If you set maven.nar.includefilesonly to true the compilation step will be skipped. This flag can be used if you want to distribute a library that only contains pure abstract classes in include files.</b></p>
</div>
<div class="section"><h3><a name="nar-testCompile">nar-testCompile</a></h3>
<p>This goal will compile the native test source code (c, c++ or fortran) and create executables from it. To handle the variety of compilers and linkers, the NAR plugin uses the cpptasks from the ant-contrib project, with some minor improvements and additions of compilers, see <a href="cpptasks.html">cpptasks</a>. Most of the settings for cpptasks, such as compiler, linker, options and include dirs are available through the NAR plugin, see <a href="configuration.html">configuration</a>.</p>
<p>The NAR plugin searches the directory structure under COMPILER.sourceDirectory, which defaults to src/test. The standard way to separate your sources for different languages would be src/test/c, src/test/c++ and src/test/fortran, but any file under src/test is searched for.</p>
<p>The compiler will automatically select the correct compiler (c, c++ or fortran) based on the type of sources, as specified in the patterns in <tt>AOL.c.includes</tt>, <tt>AOL.nar.src.includes</tt> and <tt>AOL.fortran.includes</tt>, where AOL is a dotted qualifier of the architecture, os and linker (x86.Windows.msvc for example).</p>
<p><b>TBD If you set maven.nar.includefilesonly to true the compile-tests goal will be skipped.</b></p>
</div>
<div class="section"><h3><a name="nar-test">nar-test</a></h3>
<p>Runs any native tests as well as any executables that have been produced.</p>
</div>
<div class="section"><h3><a name="nar-package">nar-package</a> </h3>
<p>This goal creates the artifact jar/nar file(s). The jar file is created by the standard package goal. The following jar and nar files are created:</p>
<ul><li>&lt;Artifact&gt;-&lt;version&gt;.jar, containing a property file describing the behaviour of the library and other nar files available. For a description see <a href="nar-dependencies.html"> nar-dependencies</a>.</li>
<li>&lt;Artifact&gt;-&lt;version&gt;-noarch.nar, a compressed jar file containing non machine specific parts of the distribution, such as the include directories.</li>
<li>&lt;Artifact&gt;-&lt;version&gt;-&lt;aol&gt;-&lt;type&gt;.nar, a compressed jar file containing machine specific parts of the distribution, such as the libraries. This file is specific to a particular Architecture-OS-Linker (AOL) combination <b>TBD and is not generated if maven.nar.includefilesonly is set</b>. Type specifies if this nar is either of type shared, static or jni.</li>
</ul>
</div>
<div class="section"><h3><a name="nar-integration-test">nar-integration-test</a></h3>
<p>This goal runs tests against the packaged jar and nar files. Currently this is useful only to test a jni library. The jni library is added to the java.library.path and the tests are forked to pick up this path.</p>
<p>To use this goal you need to put the test sources in the regular test directories but disable the running of the tests by the maven-surefire-plugin.</p>
<p><b>TBD integration tests for other types of libraries than jni</b></p>
</div>
<div class="section"><h3><a name="install">install</a> </h3>
<p>This goal installs the produced artifacts in your local repository. The unpacking is done in the unpack goal of a dependent artifact upon first usage.</p>
</div>
<div class="section"><h3><a name="deploy">deploy</a></h3>
<p>This goal deploys the produced artifacts on a maven (web) server. The jar and nar files only consists in their full form on the server and are never unpacked on the server. </p>
</div>
</div>

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2002-2009
    
          The Apache Software Foundation
          
  

  
    
            
  
    
   - <a href="http://maven.apache.org/privacy-policy.html">Privacy Policy</a></div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
